# Architecture: Hackathon Todo Phase II â€“ Full Stack Web Application

## Monorepo Architecture
The system follows a monorepo structure with the following organization:
- `/specs` - All specifications and documentation
- `/frontend` - Next.js application code
- `/backend` - FastAPI backend code
- Root directory - Configuration and shared resources

## Frontend/Backend Interaction
- Frontend communicates with backend via REST API
- All API requests include JWT in Authorization header
- Frontend handles UI rendering and client-side validation
- Backend manages business logic and data persistence

## Authentication Flow
1. User accesses frontend application
2. If unauthenticated, redirected to login/signup page
3. User credentials submitted to Better Auth
4. Better Auth validates credentials and issues JWT
5. JWT stored in browser (localStorage/cookies)
6. Subsequent API requests include JWT in Authorization header

## JWT Flow
1. User authenticates via Better Auth
2. JWT issued with user identity claims
3. JWT sent with each API request in Authorization header
4. Backend verifies JWT signature and validity
5. User ID extracted from JWT for ownership verification
6. Requests processed with user context

## Data Flow
1. User interacts with frontend UI
2. Frontend sends authenticated requests to backend
3. Backend verifies JWT and extracts user ID
4. Backend enforces ownership checks against user ID
5. Database operations performed with user-specific filters
6. Response returned to frontend with appropriate data

## Agent-Driven Workflow
1. Specifications created using AI agents
2. Implementation plans generated from specs
3. Code generated by AI agents based on plans
4. Tasks tracked and validated against constitutional principles
5. No manual coding allowed - all changes through AI agents
6. Continuous validation against constitutional requirements

## Security Considerations
- All API endpoints require JWT authentication
- User data isolation enforced at database level
- JWT validation occurs on every request
- Session management follows JWT expiration policies
- Input validation performed on both frontend and backend

## Agent and Skills Framework
- AI agents must be used according to their designated purposes
- Specialized skills (stored in .qwen/skills/) must be leveraged to enhance agent capabilities
- The nextjs skill must be used for Next.js development tasks
- Agent usage must comply with constitutional principles and development workflows
- Appropriate AI agents must be selected based on the task at hand:
  - Use nextjs-builder for Next.js application development
  - Use specification-agent for creating comprehensive technical specifications
  - Use spec-auditor for compliance and security audits
  - Use project-planner for creating comprehensive project plans
  - Use task-decomposer for breaking down complex projects into executable tasks
  - Use constitution-agent for defining system laws and governance policies
  - Use jwt-security-auditor for auditing JWT authentication flows